# 🆕 用户注册功能指南

## ✅ 功能概述

Neura平台现在支持用户自助注册，无需手动创建用户账户。新的注册系统具有以下特点：

### 🎯 核心功能
- **自助注册** - 用户可以通过邮箱和密码直接注册
- **密码要求** - 密码长度至少8位，支持任意字符组合
- **邮箱验证** - 自动完成邮箱确认，无需手动验证
- **自动登录** - 注册成功后自动登录并跳转到主页
- **用户档案** - 自动创建用户profile，默认角色为recruiter

### 🔒 安全特性
- **表单验证** - 前端和后端双重验证
- **密码强度** - 要求至少8位密码
- **邮箱格式** - 验证邮箱格式有效性
- **重复检查** - 防止重复注册相同邮箱
- **自动确认** - 注册即可使用，无需等待邮箱确认

## 🚀 如何使用

### 1. 访问注册页面
- 访问 `http://localhost:3002/register`
- 或在登录页面点击"立即注册"链接

### 2. 填写注册信息
- **昵称** - 输入您的昵称或显示名称
- **邮箱地址** - 输入有效的邮箱地址
- **密码** - 输入至少8位密码
- **确认密码** - 再次输入相同密码

### 3. 提交注册
- 点击"注册"按钮
- 系统会自动验证所有信息
- 注册成功后自动登录

### 4. 开始使用
- 注册成功后直接进入主页
- 可以立即使用所有功能：
  - 智能搜索
  - 上传简历/职位
  - 查看搜索历史

## 🔧 技术实现

### 前端验证
- **必填字段** - 所有字段都是必填的
- **邮箱格式** - 使用正则表达式验证邮箱格式
- **密码长度** - 确保密码至少8位
- **密码确认** - 确保两次输入的密码一致

### 后端处理
- **API路由** - `/api/auth/register` 处理注册请求
- **数据验证** - 服务器端再次验证所有数据
- **用户创建** - 使用Supabase Auth创建用户
- **邮箱确认** - 使用SQL函数自动确认邮箱
- **profile创建** - 在profiles表中创建用户档案

### 数据库操作
- **用户表** - 在auth.users表中创建用户记录
- **邮箱确认** - 自动设置email_confirmed_at字段
- **用户档案** - 在profiles表中创建用户档案
- **默认角色** - 设置为recruiter角色

## 📋 数据库设置

### 1. 执行SQL函数
请在 Supabase Dashboard 的 SQL Editor 中执行 `database/user_management_functions.sql` 中的内容：

```sql
-- 创建自动确认用户邮箱的函数
CREATE OR REPLACE FUNCTION confirm_user_email(user_email TEXT)
RETURNS VOID AS $$
BEGIN
  UPDATE auth.users 
  SET 
    email_confirmed_at = now(),
    updated_at = now()
  WHERE email = user_email;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### 2. 确保profiles表存在
确保已创建profiles表：

```sql
-- 检查profiles表是否存在
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' AND table_name = 'profiles';
```

## 🧪 测试注册功能

### 1. 基本注册测试
- 访问注册页面
- 填写以下信息：
  - 昵称：测试用户
  - 邮箱：test@example.com
  - 密码：12345678
  - 确认密码：12345678
- 点击注册按钮
- 验证是否成功跳转到主页

### 2. 验证测试
- **空字段测试** - 尝试提交空字段
- **邮箱格式测试** - 输入无效邮箱格式
- **密码长度测试** - 输入少于8位密码
- **密码不一致测试** - 两次输入不同密码
- **重复邮箱测试** - 使用已注册的邮箱

### 3. 功能测试
- 注册成功后验证：
  - 是否自动登录
  - 是否显示用户头像/菜单
  - 是否可以访问所有功能
  - 是否可以上传数据

## 🎨 界面设计

### 登录页面更新
- **注册链接** - 在登录页面底部添加"立即注册"链接
- **一致性设计** - 与登录页面保持相同的设计风格
- **响应式布局** - 适配不同屏幕尺寸

### 注册页面特点
- **左右布局** - 左侧表单，右侧品牌展示
- **表单验证** - 实时验证反馈
- **加载状态** - 注册过程中显示加载状态
- **错误处理** - 友好的错误提示信息

## 📊 用户管理

### 查看注册用户
可以在 Supabase Dashboard 中查看所有注册用户：

```sql
-- 查看所有注册用户
SELECT 
  u.id,
  u.email,
  u.raw_user_meta_data->>'full_name' as full_name,
  u.email_confirmed_at,
  u.created_at,
  p.role
FROM auth.users u
LEFT JOIN profiles p ON u.id = p.user_id
ORDER BY u.created_at DESC;
```

### 管理员功能
- **批量确认邮箱** - 使用 `confirm_all_unconfirmed_emails()` 函数
- **删除用户** - 使用 `delete_user_account(user_id)` 函数
- **查看用户档案** - 使用 `get_user_profile(user_id)` 函数

## 🔍 故障排除

### 常见问题

1. **注册失败**
   - 检查邮箱格式是否正确
   - 确认密码长度是否至少8位
   - 验证邮箱是否已被注册

2. **邮箱确认问题**
   - 检查 `confirm_user_email` 函数是否已创建
   - 确认函数权限设置正确

3. **自动登录失败**
   - 检查浏览器控制台错误
   - 确认用户创建成功
   - 验证邮箱确认状态

### 调试步骤
1. 检查浏览器控制台的错误信息
2. 查看Network标签的API请求响应
3. 在Supabase Dashboard查看用户是否创建成功
4. 检查profiles表是否有对应记录

## 🎉 完成状态

✅ **注册页面** - 完整的注册表单界面
✅ **API路由** - 处理注册请求的后端API
✅ **数据验证** - 前后端双重验证
✅ **自动确认** - 无需手动确认邮箱
✅ **用户档案** - 自动创建用户profile
✅ **路由保护** - 防止已登录用户访问注册页面
✅ **错误处理** - 友好的错误提示
✅ **自动登录** - 注册成功后自动登录

现在用户可以：
- 自助注册新账户
- 立即开始使用平台功能
- 无需等待邮箱确认
- 享受完整的用户体验

注册功能已完全集成到现有系统中，与登录、认证、数据管理等功能无缝配合！ 