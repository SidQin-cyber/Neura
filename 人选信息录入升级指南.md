# 人选信息录入升级指南

## 🎯 升级目标

将候选人数据结构从"能用"升级到"好用"，通过添加关键字段让AI搜索的rerank分数从0提升到有意义的分数（40%+）。

## 📋 需要执行的数据库操作

### 第1步：执行数据库表结构升级

在Supabase控制台的SQL Editor中执行 `add-missing-candidate-fields.sql` 文件：

```sql
-- 添加关键字段
ALTER TABLE resumes ADD COLUMN IF NOT EXISTS summary TEXT;
ALTER TABLE resumes ADD COLUMN IF NOT EXISTS relocation_preferences TEXT[];
ALTER TABLE resumes ADD COLUMN IF NOT EXISTS projects JSONB;
```

### 第2步：更新搜索函数

在Supabase控制台的SQL Editor中执行 `update-search-functions-for-enhanced-fields.sql` 文件，这将：
- 更新 `search_candidates_rpc` 函数
- 添加新字段到返回结果
- 构建丰富的 `full_text_content` 供rerank使用

## 📊 新增字段说明

| 字段名 | 类型 | 作用 | 重要程度 |
|--------|------|------|----------|
| `summary` | TEXT | 个人简介，AI理解候选人"气质"的核心 | ⭐⭐⭐⭐⭐ |
| `relocation_preferences` | TEXT[] | 可接受工作地点数组 | ⭐⭐⭐⭐ |
| `projects` | JSONB | 项目经验，展现技术深度 | ⭐⭐⭐ |

## 💡 理想的候选人JSON录入格式

```json
{
  "name": "张三",
  "email": "zhangsan@example.com",
  "phone": "+8613800138000",
  "current_title": "资深后端工程师",
  "current_company": "ABC科技",
  "location": "北京",
  "years_of_experience": 8,
  "expected_salary_min": 40000,
  "expected_salary_max": 55000,
  "summary": "一位拥有8年经验的资深后端工程师，专注于使用Go和Java构建高并发分布式系统。曾在ABC公司主导交易核心重构，将系统QPS从5k提升至15k。对底层技术有浓厚兴趣，乐于迎接技术挑战。",
  "skills": [
    "Go (Gin, gRPC, GORM)",
    "Java (Spring Boot, Spring Cloud, MyBatis)",
    "数据库 (MySQL, PostgreSQL, Redis, TiDB)",
    "中间件 (Kafka, RabbitMQ)",
    "容器化 (Docker, Kubernetes)"
  ],
  "relocation_preferences": ["上海", "深圳"],
  "experience": [
    {
      "company": "ABC科技",
      "title": "资深后端工程师", 
      "start_date": "2020-01",
      "end_date": "至今",
      "description": [
        "主导设计并实现了公司核心交易系统的2.0重构，采用微服务架构，技术栈为Go和gRPC。",
        "负责订单和支付模块的开发，处理百万级日活用户的并发请求。",
        "通过引入分布式缓存和消息队列，将核心接口的P99延迟从300ms优化至80ms。"
      ]
    }
  ],
  "projects": [
    {
      "name": "天穹分布式任务调度系统",
      "description": "一个受xxl-job启发的分布式任务调度平台，使用Go语言开发，实现了任务的高可用和分片执行。",
      "tech_stack": ["Go", "Raft", "gRPC", "Redis"]
    }
  ],
  "education": [
    {
      "degree": "硕士",
      "institution": "北京邮电大学",
      "field_of_study": "计算机科学与技术"
    }
  ]
}
```

## 🔄 升级后的搜索流程

1. **向量搜索（召回）**: 基于整体语义相似度召回候选人
2. **Rerank（精排）**: 使用丰富的 `full_text_content` 进行精准排序
3. **分数计算**: 向量相似度(50%) + 增强Rerank(30%) + 语义匹配(20%)
4. **用户友好显示**: 转换为25-100%的可读分数

## 📈 预期改进效果

- **Rerank分数**: 从0.000提升到有意义的分数
- **显示分数**: 从19-20%提升到45-65%
- **搜索精度**: 显著提升，特别是复杂语义搜索
- **用户体验**: 联系方式直接显示在卡片上

## ✅ 完成状态检查清单

- [ ] 执行 `add-missing-candidate-fields.sql`（添加新字段）
- [ ] 执行 `update-search-functions-for-enhanced-fields.sql`（更新搜索函数）
- [ ] 验证前端显示联系方式
- [ ] 测试搜索功能是否正常
- [ ] 按新格式录入/更新候选人数据

执行完这些步骤后，你的AI搜索系统将达到生产级别的质量！ 